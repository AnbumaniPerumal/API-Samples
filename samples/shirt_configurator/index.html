<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Lagoa Shirt Demo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Loading Bootstrap -->
    <link href="../assets/Flat-UI-master/bootstrap/css/bootstrap.css" rel="stylesheet">

    <!-- Loading Flat UI -->
    <link href="../assets/Flat-UI-master/css/flat-ui.css" rel="stylesheet">

    <link rel="shortcut icon" href="../assets/Flat-UI-master/images/favicon.ico">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements. All other JS at the end of file. -->
    <!--[if lt IE 9]>
    <script src="../assets/Flat-UI-master/js/html5shiv.js"></script>
    <![endif]-->

  <!-- Load JS here for greater good =============================-->
  <script src="../assets/Flat-UI-master/js/jquery-1.8.3.min.js"></script>
  <script src="../assets/Flat-UI-master/js/jquery-ui-1.10.3.custom.min.js"></script>
  <script src="../assets/Flat-UI-master/js/jquery.ui.touch-punch.min.js"></script>
  <script src="../assets/Flat-UI-master/js/bootstrap.min.js"></script>
  <script src="../assets/Flat-UI-master/js/bootstrap-select.js"></script>
  <script src="../assets/Flat-UI-master/js/bootstrap-switch.js"></script>
  <script src="../assets/Flat-UI-master/js/flatui-checkbox.js"></script>
  <script src="../assets/Flat-UI-master/js/flatui-radio.js"></script>
  <script src="../assets/Flat-UI-master/js/jquery.tagsinput.js"></script>
  <script src="../assets/Flat-UI-master/js/jquery.placeholder.js"></script>


  <!-- Bootstrap -->
  <!-- Latest compiled and minified CSS -->
  <link href="http://netdna.bootstrapcdn.com/bootstrap/3.0.0-rc2/css/bootstrap.min.css" rel="stylesheet">

  <!-- Latest compiled and minified JavaScript -->
  <script src="http://netdna.bootstrapcdn.com/bootstrap/3.0.0-rc2/js/bootstrap.min.js"></script>

  <!-- Latest Glyphicons minified CSS -->
  <link href="http://netdna.bootstrapcdn.com/bootstrap/3.0.0-rc2/css/bootstrap-glyphicons.css" rel="stylesheet">

  <!-- LAGOA API -->
  <script src="../../build/lapi.js"></script>

  <style media="screen">
    body {
      background: whitesmoke;
    }

    #patterns img{
      width : 50px;
      height: 50px;
      margin: 2px;
      border-radius: 8px;
    }

    #patterns img:hover{
      /*width: 100px;*/
      /*height: 100px;*/
      outline : 4px solid #ffff00;
      border-radius: 8px;
    }

    .fillVertical{
      height:100%;
    }
    .fillVertical iframe{
      float : right;
      width : 650px;
      height: 100%;
    }
  </style>

  </head>

<body>
  <div class="container">
    <div class="row">
      <div class="col-md-3">
        <h1>Customizer</h1>
        <div class="row">
          <div class="col-md-12">
            <p>Pattern</p>
            <div id="patterns"></div>
          </div>
          <br>
          <div class="col-md-12">
            <p>Color</p>
          </div>
          <br>
          <div class="col-md-12">
            <p>Logo</p>
          </div>
          <br>
          <div class="col-md-12">
            <a href="#fakelink" class="btn btn-block btn-lg btn-primary js-orbit">Orbit</a>
          </div>
          <br>
          <div class="col-md-12">
            <a href="#fakelink" class="btn btn-block btn-lg btn-primary js-pan">Pan</a>
          </div>
          <br>
          <div class="col-md-12">
            <p>Zoom</p>
            <div id="slider"></div>
          </div>
        </div>
      </div>
      <div class="col-md-9 fillVertical">
        <iframe src="https://lagoa.com/embed_links/505?validationHash=vL9zieLiPDJlsDr6UDz0LQ&width=500&height=330&fontcolor=&auto_load_scene=true&lagoa_logo=true" id="lagoaframe" width="500" height="330" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>
      </div>
    </div>
  </div>

  <script>
    // some constants
    var ONE_OVER_255 = 1/255;
    var EXPORT_TAG = "export";

    // add some buttons
    $('.js-orbit').bind( "click", function(){
      lapi.orbitTool();
    });


    $('.js-pan').bind( "click", function(){
      lapi.panTool();
    });

    /*
    $('button[name="js-move"]').bind( "click", function(){
      lapi.moveTool();
    });

    $('button[name="js-scale"]').bind( "click", function(){
      lapi.scaleTool();
    });
    */

    function setOnClickPattern( in_htmlElement, in_parameter, in_clickValue ){
      $(in_htmlElement).click(function(e){
        in_parameter.value = in_clickValue;
      })
    }

    function addPatterns(){
      // our patterns
      var scn = lapi.getActiveScene()
      var textures = scn.getTextures();

      // scrape all textures that start with "EXPORT_TAG".
      var tmpTexture = null;
      var textureName = "";
      var isExport = false;

      // expose all textures
      for( var i=0 ;i<textures.length; ++i){
        tmpTexture = textures[i];
        textureName = tmpTexture.properties.parameters.Name.value;
        isExport = textureName.indexOf(EXPORT_TAG);
        if(isExport >= 0){

          // create the HTML element
          var imgUrl = tmpTexture.getProperty("url").parameters.URL.value;
          var img = $(document.createElement('img'));

          // grab the parameter that the element will handle
          var mat = lapi.getActiveScene().getObjectByName("shirt_material_1")[0];
          var param = mat.getProperty("color").parameters.Texture;

          // assign the callback
          setOnClickPattern( img, param, tmpTexture.properties.parameters.GUID.value );

          img.attr('src', imgUrl );
          img.appendTo('#patterns');
        }
      }

    }

    // lens zoom slider
    function refreshSlider(e, nr){
      var cam = lapi.getCamera();
      cam.properties.getProperty("Lens").parameters.Zoom.value = nr.value;
    }

    $( "#slider" ).slider( { orientation: "horizontal",
    range: "min",
    min : 15,
    max: 100,
    value: 15,
    slide: refreshSlider,
    change: refreshSlider });

    $(document).ready(function() {

      // called once the scene is fully loaded â€“ warning: geometry might not be present!
      lapi.onSceneLoaded = function(){

        // set some defaults
        var scn = lapi.getActiveScene();
        var cam = scn.getCameras()[0];
        cam.getProperty("Lens").getParameter("Depth of field radius").value = 0;
        cam.getProperty("Resolution").getParameter("Width").value = 720;

        // make sure nothing is selected
        lapi.desselectAll();

        // build our app UI
        addPatterns();

        // start rendering and hide meshes
        setTimeout( function(){
          // now we will set all the GL meshes to not visible
          var meshes = scn.getMeshes();
          for( var m in meshes ){
            meshes[m].getProperty("Visibility").getParameter("Visible").value = false;
          }

          // start rendering
          lapi.startRender()

        }, 2000 );
      };

      var RADIUS = 5;
      var SPEED = .005;

      lapi.stepCb = function(dt){
        var cam = lapi.getCamera();
        var pos = cam.properties.getProperty("Position");
        pos.parameters.x.value = RADIUS * Math.sin(SPEED*dt) * (2*Math.PI);
        pos.parameters.z.value = RADIUS * Math.cos(SPEED*dt) * (2*Math.PI);
      }

    });

  </script>

  </body>
</html>